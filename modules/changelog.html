<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Elite: Dark Frontier — Бортовой журнал разработки</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');
:root {
  --amber: #ffaa00; --gold: #ffdd99; --dark: #060810;
  --red: #ff4444; --green: #44ff88; --blue: #44aaff; --purple: #cc66ff; --cyan: #00eeff;
}
* { margin:0; padding:0; box-sizing:border-box; }
body {
  background: var(--dark);
  font-family: 'VT323', monospace;
  color: var(--gold);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Scanline overlay */
body::after {
  content:''; position:fixed; inset:0; pointer-events:none; z-index:9999;
  background:repeating-linear-gradient(0deg,rgba(255,200,100,.015) 0px,rgba(0,0,0,.06) 2px,transparent 3px);
  mix-blend-mode:multiply;
}

/* Header */
.header {
  text-align:center; padding:28px 20px 20px;
  border-bottom:2px solid var(--amber);
  background:radial-gradient(ellipse at 50% 100%, rgba(255,170,0,.06) 0%, transparent 70%);
  position:relative;
}
.header::after {
  content:''; position:absolute; bottom:-1px; left:0; right:0; height:1px;
  background:linear-gradient(90deg, transparent, rgba(255,170,0,0.3), transparent);
}
.header h1 {
  font-family:'Press Start 2P',cursive; font-size:16px; color:#ffee88;
  text-shadow:0 0 24px rgba(255,170,0,0.7),0 0 50px rgba(255,100,0,0.25), 0 2px 0 #553300;
  margin-bottom:10px; letter-spacing:3px;
  animation: title-pulse 4s ease-in-out infinite;
}
@keyframes title-pulse {
  0%,100% { text-shadow:0 0 24px rgba(255,170,0,0.7),0 0 50px rgba(255,100,0,0.25), 0 2px 0 #553300; }
  50% { text-shadow:0 0 32px rgba(255,170,0,0.9),0 0 60px rgba(255,100,0,0.4), 0 2px 0 #553300; }
}
.header .sub {
  font-size:18px; color:#997744; max-width:700px; margin:0 auto;
  text-shadow:0 1px 2px rgba(0,0,0,0.6);
}

/* Breaking news ticker */
.ticker-wrap {
  background:linear-gradient(90deg, rgba(255,0,0,.06) 0%, rgba(255,0,0,.03) 50%, rgba(255,0,0,.06) 100%);
  border-bottom:1px solid rgba(255,68,68,0.4);
  overflow:hidden; height:36px; display:flex; align-items:center;
  position:relative;
}
.ticker-tag {
  background:linear-gradient(135deg, var(--red) 0%, #cc2200 100%); color:#fff; font-family:'Press Start 2P',cursive;
  font-size:7px; padding:6px 14px; white-space:nowrap; flex-shrink:0;
  letter-spacing:2px; animation:pulse-tag 2s ease-in-out infinite;
  text-shadow:0 1px 0 rgba(0,0,0,0.3); z-index:2;
}
@keyframes pulse-tag { 0%,100%{opacity:1} 50%{opacity:.65} }
.ticker-scroll { flex:1; overflow:hidden; position:relative; height:100%; }
.ticker-text {
  white-space:nowrap; color:#ff9999; font-size:16px;
  position:absolute; top:50%; transform:translateY(-50%);
  animation: scroll-left 40s linear infinite;
  text-shadow:0 0 6px rgba(255,100,100,0.15);
}
@keyframes scroll-left {
  0% { left:100%; }
  100% { left:-200%; }
}

/* Filter bar */
.filters {
  display:flex; gap:6px; padding:16px 24px; flex-wrap:wrap;
  border-bottom:1px solid rgba(255,170,0,0.08); align-items:center;
  background:rgba(255,170,0,0.015);
}
.filters .label {
  font-family:'Press Start 2P',cursive; font-size:8px;
  color:#665522; margin-right:10px; letter-spacing:1px;
}
.filter-btn {
  background:transparent; border:1px solid rgba(255,170,0,0.12); color:#776633;
  padding:6px 14px; cursor:pointer; font-family:'VT323',monospace;
  font-size:15px; transition:all .2s ease; text-transform:uppercase;
  border-radius:3px;
}
.filter-btn:hover { border-color:rgba(255,170,0,0.5); color:var(--gold); background:rgba(255,170,0,0.04); }
.filter-btn.active {
  background:linear-gradient(180deg, rgba(255,170,0,.12) 0%, rgba(255,170,0,.04) 100%);
  border-color:var(--amber); color:#ffee88;
  text-shadow:0 0 8px rgba(255,170,0,0.4);
  box-shadow:0 0 8px rgba(255,170,0,0.1);
}

/* Timeline */
.timeline { max-width:920px; margin:0 auto; padding:24px 24px 60px; position:relative; }
.timeline::before {
  content:''; position:absolute; left:36px; top:0; bottom:0;
  width:2px; background:linear-gradient(180deg,rgba(255,170,0,0.5),rgba(50,30,0,0.3),transparent);
}

/* Version block */
.version-block { margin-bottom:30px; position:relative; animation:fadeInUp .5s ease both; }
@keyframes fadeInUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
.version-header {
  display:flex; align-items:center; gap:12px; margin-bottom:14px;
  position:relative; padding-left:56px;
}
.version-dot {
  position:absolute; left:28px; width:16px; height:16px;
  border-radius:50%; border:2px solid rgba(255,170,0,0.6);
  background:var(--dark); z-index:2;
  box-shadow:0 0 10px rgba(255,170,0,.25);
  transition:box-shadow .3s;
}
.version-block:hover .version-dot { box-shadow:0 0 16px rgba(255,170,0,.5); }
.version-dot.hot { background:var(--red); border-color:var(--red);
  box-shadow:0 0 14px rgba(255,68,68,0.5); animation:dot-pulse 2s ease-in-out infinite; }
@keyframes dot-pulse { 0%,100%{box-shadow:0 0 10px rgba(255,68,68,0.4)} 50%{box-shadow:0 0 18px rgba(255,68,68,0.7)} }
.version-tag {
  font-family:'Press Start 2P',cursive; font-size:11px; color:#ffee88;
  text-shadow:0 0 8px rgba(255,170,0,0.3);
  background:linear-gradient(135deg, rgba(255,170,0,.08) 0%, rgba(255,170,0,.03) 100%);
  border:1px solid rgba(255,170,0,0.4);
  padding:5px 14px; border-radius:3px;
}
.version-date { font-size:15px; color:#776633; }
.version-title { font-size:19px; color:var(--gold); font-weight:bold; text-shadow:0 1px 2px rgba(0,0,0,0.5); }

/* Entry cards */
.entries { padding-left:56px; display:flex; flex-direction:column; gap:6px; }
.entry {
  display:flex; gap:12px; padding:12px 16px;
  border:1px solid rgba(255,170,0,0.08); background:rgba(255,170,0,.015);
  transition:all .25s ease; position:relative; overflow:hidden;
  border-radius:4px;
}
.entry:hover {
  border-color:rgba(255,170,0,0.25); background:rgba(255,170,0,.04);
  transform:translateX(4px);
}
.entry::before {
  content:''; position:absolute; left:0; top:0; bottom:0; width:3px; border-radius:3px 0 0 3px;
}
.entry.feat::before { background:var(--green); box-shadow:0 0 6px rgba(68,255,136,0.3); }
.entry.fix::before { background:var(--red); box-shadow:0 0 6px rgba(255,68,68,0.3); }
.entry.improve::before { background:var(--blue); box-shadow:0 0 6px rgba(68,170,255,0.3); }
.entry.visual::before { background:var(--purple); box-shadow:0 0 6px rgba(204,102,255,0.3); }
.entry.data::before { background:var(--cyan); box-shadow:0 0 6px rgba(0,238,255,0.3); }

.entry-badge {
  font-family:'Press Start 2P',cursive; font-size:6px;
  padding:4px 9px; border-radius:3px; flex-shrink:0;
  white-space:nowrap; align-self:flex-start; margin-top:2px;
}
.entry.feat .entry-badge { background:rgba(68,255,136,.1); color:var(--green); border:1px solid rgba(68,255,136,0.35); }
.entry.fix .entry-badge { background:rgba(255,68,68,.1); color:var(--red); border:1px solid rgba(255,68,68,0.35); }
.entry.improve .entry-badge { background:rgba(68,170,255,.1); color:var(--blue); border:1px solid rgba(68,170,255,0.35); }
.entry.visual .entry-badge { background:rgba(204,102,255,.1); color:var(--purple); border:1px solid rgba(204,102,255,0.35); }
.entry.data .entry-badge { background:rgba(0,238,255,.1); color:var(--cyan); border:1px solid rgba(0,238,255,0.35); }

.entry-body { flex:1; }
.entry-title { font-size:17px; color:#eedd99; font-weight:bold; }
.entry-desc { font-size:14px; color:#887744; margin-top:3px; line-height:1.5; }
.entry-module {
  font-size:10px; color:#4a3515; margin-top:4px;
  font-family:'Press Start 2P',cursive; letter-spacing:1px;
}

/* Stats */
.stats-bar {
  display:flex; gap:20px; padding:16px 24px;
  background:linear-gradient(180deg, rgba(255,170,0,.025) 0%, transparent 100%);
  border-bottom:1px solid rgba(255,170,0,0.08);
  flex-wrap:wrap; justify-content:center;
}
.stat-item { text-align:center; min-width:60px; }
.stat-num { font-size:24px; color:#ffee88; font-weight:bold; text-shadow:0 0 8px rgba(255,200,0,0.2); }
.stat-label { font-size:10px; color:#554400; font-family:'Press Start 2P',cursive; letter-spacing:1px; }

/* Scroll fade */
.timeline::after {
  content:''; position:fixed; bottom:0; left:0; right:0; height:50px;
  background:linear-gradient(transparent,var(--dark));
  pointer-events:none; z-index:100;
}

/* Scrollbar */
body::-webkit-scrollbar { width:6px; }
body::-webkit-scrollbar-track { background:transparent; }
body::-webkit-scrollbar-thumb { background:rgba(255,170,0,0.3); border-radius:3px; }
body::-webkit-scrollbar-thumb:hover { background:rgba(255,170,0,0.5); }
body { scrollbar-width:thin; scrollbar-color:rgba(255,170,0,0.3) transparent; }

/* ═══ MOBILE / iPHONE ═══ */
@media(max-width:700px){
  .header { padding:16px 12px 12px; }
  .header h1 { font-size:11px; letter-spacing:1px; }
  .header .sub { font-size:14px; }

  .ticker-wrap { height:30px; }
  .ticker-tag { font-size:6px; padding:4px 8px; }
  .ticker-text { font-size:13px; }

  .stats-bar { gap:10px; padding:12px 12px; }
  .stat-num { font-size:18px; }
  .stat-label { font-size:7px; letter-spacing:0; }

  .filters { padding:10px 12px; gap:4px; }
  .filters .label { font-size:7px; margin-right:4px; }
  .filter-btn { padding:5px 9px; font-size:13px; }

  .timeline { padding:12px 10px 60px; }
  .timeline::before { left:16px; }
  .version-header { padding-left:36px; flex-wrap:wrap; gap:6px; }
  .version-dot { left:8px; width:14px; height:14px; }
  .version-tag { font-size:9px; padding:3px 8px; }
  .version-date { font-size:12px; }
  .version-title { font-size:15px; }
  .entries { padding-left:36px; }
  .entry { padding:10px 10px; gap:8px; }
  .entry-badge { font-size:5px; padding:3px 6px; }
  .entry-title { font-size:14px; }
  .entry-desc { font-size:12px; }
  .entry-module { font-size:8px; }
}

@media(max-width:400px){
  .header h1 { font-size:9px; }
  .version-tag { font-size:8px; }
  .version-title { font-size:13px; }
  .stat-num { font-size:16px; }
  .filter-btn { font-size:11px; padding:3px 6px; }
}

@supports (padding-bottom: env(safe-area-inset-bottom)) {
  .timeline { padding-bottom: calc(60px + env(safe-area-inset-bottom)); }
}
</style>
</head>
<body>

<div class="header">
  <h1>БОРТОВОЙ ЖУРНАЛ РАЗРАБОТКИ</h1>
  <div class="sub">Секретные передачи из штаба ELITE: DARK FRONTIER. Все обновления, патчи и новые системы.</div>
</div>

<div class="ticker-wrap">
  <div class="ticker-tag">HOT NEWS</div>
  <div class="ticker-scroll">
    <div class="ticker-text" id="ticker-text"></div>
  </div>
</div>

<div class="stats-bar" id="stats-bar"></div>

<div class="filters">
  <span class="label">ФИЛЬТР:</span>
  <button class="filter-btn active" data-filter="all">ВСЕ</button>
  <button class="filter-btn" data-filter="feat">НОВОЕ</button>
  <button class="filter-btn" data-filter="fix">ФИКСЫ</button>
  <button class="filter-btn" data-filter="improve">УЛУЧШЕНИЯ</button>
  <button class="filter-btn" data-filter="visual">ВИЗУАЛ</button>
  <button class="filter-btn" data-filter="data">ДАННЫЕ</button>
</div>

<div class="timeline" id="timeline"></div>

<script>
// ═══════════════════════════════════════════════════
//  CHANGELOG DATA
// ═══════════════════════════════════════════════════
const CHANGELOG = [
  {
    version: 'v4.2.0', date: '28 ФЕВ 2026', title: 'КАПИТАЛЬНАЯ ПЕРЕСТРОЙКА ЗВЁЗДНОЙ КАРТЫ',
    hot: true,
    entries: [
      {type:'feat', title:'Карта неба переписана с нуля', desc:'2117 строк → 680. Чистый модульный код, все фичи сохранены. Быстрее, стабильнее, читаемее.', module:'STARMAP'},
      {type:'improve', title:'Оптимизация маршрутизации', desc:'Снижено с 25 до 10 путей — расчёт мгновенный, без зависаний. Алгоритм тот же, но быстрее.', module:'STARMAP'},
      {type:'improve', title:'Торговые частицы оптимизированы', desc:'800 вместо 1500 частиц. Плавная анимация на слабых GPU.', module:'STARMAP'},
      {type:'visual', title:'CSS через переменные', desc:'Единый стиль .panel/.btn. Все панели унифицированы. Меньше дублирования.', module:'STARMAP'},
      {type:'fix', title:'Исправлен баг dollyIn/dollyOut', desc:'OrbitControls r132 не имеет публичных dolly-методов. Заменено на lerp камеры.', module:'STARMAP'},
      {type:'feat', title:'Бортовой журнал разработки', desc:'Новый модуль — вы сейчас его читаете. Hot news, фильтры, таймлайн.', module:'CHANGELOG'},
    ]
  },
  {
    version: 'v4.1.0', date: '27 ФЕВ 2026', title: 'NASA LIVE DATA',
    entries: [
      {type:'feat', title:'NASA APOD на главной', desc:'Астрономическое фото дня загружается с api.nasa.gov. Реальное изображение космоса каждый день.', module:'ГЛАВНАЯ'},
      {type:'feat', title:'NASA NEO — околоземные объекты', desc:'Реальные астероиды, пролетающие мимо Земли сегодня. Данные обновляются ежедневно.', module:'STARMAP'},
      {type:'data', title:'15 галактических новостей', desc:'Научные факты + игровой лор. Нейтронные звёзды, экзопланеты, торговые кризисы.', module:'STARMAP'},
    ]
  },
  {
    version: 'v4.0.0', date: '26 ФЕВ 2026', title: 'ЕДИНАЯ ЭКОНОМИКА И НАВИГАЦИЯ',
    entries: [
      {type:'feat', title:'Модульная архитектура', desc:'index.html — хаб с iframe-модулями. Единый gameState через postMessage. Навбар, профиль пилота.', module:'CORE'},
      {type:'feat', title:'Кабинет пилота', desc:'Навыки (6 веток), ранги, XP, репутация, статистика. Панель справа с анимацией.', module:'PROFILE'},
      {type:'feat', title:'Карта 5000+ звёзд', desc:'Реальные звёзды из каталога HIP (Hipparcos). Цвета по B-V индексу. Солнечная система с 8 планетами.', module:'STARMAP'},
      {type:'feat', title:'Просчёт маршрутов', desc:'Выбор двух звёзд → поиск путей с визуализацией. Список альтернативных маршрутов, расчёт топлива.', module:'STARMAP'},
      {type:'feat', title:'Торговые маршруты', desc:'Безье-кривые между массивными звёздами. 800 анимированных частиц. Корабли-метки у станций.', module:'STARMAP'},
      {type:'feat', title:'Верфь кораблей', desc:'3 конструктора: боевой корабль, транспорт, станция. До 14 модулей, wireframe-рендер.', module:'CONSTRUCTORS'},
      {type:'feat', title:'Добыча ресурсов', desc:'Полёт в поле астероидов, лазерная стрельба, сбор руды в трюм.', module:'MINING'},
      {type:'feat', title:'Скульптинг астероидов', desc:'7 стадий обработки с 10 математическими градиентами. 2D canvas + процедурная генерация.', module:'ASTEROID'},
      {type:'feat', title:'Планетарий', desc:'8 типов планет с Perlin-генерацией. 84 уникальных ресурса. Атмосферы и кольца.', module:'PLANETARIUM'},
      {type:'feat', title:'Ровер', desc:'6-колёсный ровер на процедурном террене. WASD-управление, разведка и сбор ресурсов.', module:'ROVER'},
      {type:'feat', title:'Спутниковый сканер', desc:'Сканирование терренов сверху. 8 биом-палитр, WebGL шейдеры, добыча ресурсов.', module:'TERRAFORMING'},
      {type:'feat', title:'Биржа', desc:'5 секторов рынка с CoinGecko API. Спарклайны, покупка/продажа акций. Динамика цен.', module:'MARKET'},
    ]
  },
  {
    version: 'v3.0.0', date: '24 ФЕВ 2026', title: 'РОЖДЕНИЕ ТЁМНОГО ФРОНТИРА',
    entries: [
      {type:'feat', title:'Первая версия звёздной карты', desc:'Three.js, OrbitControls, 5000 звёзд. Базовая навигация и торговля.', module:'STARMAP'},
      {type:'visual', title:'Ретро-стиль CRT', desc:'Scanline overlay, шрифты Press Start 2P + VT323. Янтарная палитра в стиле Elite 1984.', module:'CORE'},
      {type:'data', title:'stars.json — реальные звёзды', desc:'5000 ближайших звёзд из каталога Hipparcos. Координаты, магнитуда, спектр, B-V индекс.', module:'DATA'},
    ]
  },
];

// ═══════════════════════════════════════════════════
//  RENDER
// ═══════════════════════════════════════════════════
const BADGE_LABELS = {feat:'НОВОЕ', fix:'ФИКС', improve:'УЛУЧШЕНИЕ', visual:'ВИЗУАЛ', data:'ДАННЫЕ'};
let currentFilter = 'all';

function renderTimeline(filter) {
  const box = document.getElementById('timeline');
  box.innerHTML = '';
  CHANGELOG.forEach(ver => {
    const entries = filter === 'all' ? ver.entries : ver.entries.filter(e => e.type === filter);
    if (!entries.length) return;

    const block = document.createElement('div');
    block.className = 'version-block';
    block.innerHTML = `
      <div class="version-header">
        <div class="version-dot ${ver.hot ? 'hot' : ''}"></div>
        <span class="version-tag">${ver.version}</span>
        <span class="version-date">${ver.date}</span>
        <span class="version-title">${ver.title}</span>
      </div>
      <div class="entries">
        ${entries.map(e => `
          <div class="entry ${e.type}">
            <span class="entry-badge">${BADGE_LABELS[e.type]}</span>
            <div class="entry-body">
              <div class="entry-title">${e.title}</div>
              <div class="entry-desc">${e.desc}</div>
              <div class="entry-module">${e.module}</div>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    box.appendChild(block);
  });
}

function renderStats() {
  let feats=0, fixes=0, improves=0, total=0;
  CHANGELOG.forEach(v => v.entries.forEach(e => {
    total++;
    if(e.type==='feat')feats++;
    if(e.type==='fix')fixes++;
    if(e.type==='improve')improves++;
  }));
  document.getElementById('stats-bar').innerHTML = `
    <div class="stat-item"><div class="stat-num">${CHANGELOG.length}</div><div class="stat-label">ВЕРСИЙ</div></div>
    <div class="stat-item"><div class="stat-num">${total}</div><div class="stat-label">ИЗМЕНЕНИЙ</div></div>
    <div class="stat-item"><div class="stat-num" style="color:var(--green)">${feats}</div><div class="stat-label">НОВЫХ ФИЧЕЙ</div></div>
    <div class="stat-item"><div class="stat-num" style="color:var(--red)">${fixes}</div><div class="stat-label">ФИКСОВ</div></div>
    <div class="stat-item"><div class="stat-num" style="color:var(--blue)">${improves}</div><div class="stat-label">УЛУЧШЕНИЙ</div></div>
  `;
}

function initTicker() {
  const hot = [];
  CHANGELOG.forEach(v => {
    if (v.hot) v.entries.forEach(e => hot.push(`${v.version}: ${e.title}`));
  });
  if (!hot.length) {
    const latest = CHANGELOG[0];
    latest.entries.slice(0,3).forEach(e => hot.push(`${latest.version}: ${e.title}`));
  }
  document.getElementById('ticker-text').textContent = hot.join('   ///   ') + '   ///   ' + hot.join('   ///   ');
}

// Filters
document.querySelector('.filters').addEventListener('click', e => {
  if (!e.target.classList.contains('filter-btn')) return;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  e.target.classList.add('active');
  currentFilter = e.target.dataset.filter;
  renderTimeline(currentFilter);
});

// Init
renderStats();
renderTimeline('all');
initTicker();

// Parent communication
window.addEventListener('message', e => { if(e.data && e.data.type === 'game_state') window._gs = e.data.state; });
if (window.parent !== window) window.parent.postMessage({type:'get_state'}, '*');
</script>
</body>
</html>
