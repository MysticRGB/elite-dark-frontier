<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–õ–ò–¢–ê: –¢–Å–ú–ù–´–ô –§–†–û–ù–¢–ò–† ¬∑ –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç—Ä–æ–∏—Ç –∫–æ—Ä–∞–±–ª–∏</title>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ (–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', system-ui, sans-serif;
        }
        body {
            background: #e9dbc4;
            padding: 24px;
            color: #3f2e1e;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .tab-button {
            background: #dac09a;
            border: none;
            padding: 10px 24px;
            border-radius: 20px 20px 0 0;
            font-size: 1.2rem;
            font-weight: 500;
            color: #4f3a24;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid #b5926b;
            border-bottom: none;
            box-shadow: 0 -2px 6px rgba(110,70,30,0.1);
        }
        .tab-button:hover {
            background: #e1cdb0;
        }
        .tab-button[data-market="mining"].active { background: #ffb347; border-bottom-color: #ff8c00; }
        .tab-button[data-market="energy"].active { background: #87cefa; border-bottom-color: #00bfff; }
        .tab-button[data-market="bio"].active    { background: #98fb98; border-bottom-color: #32cd32; }
        .tab-button[data-market="industry"].active { background: #87ceeb; border-bottom-color: #4682b4; }
        .tab-button[data-market="data"].active   { background: #dda0dd; border-bottom-color: #ba55d3; }
        .tab-button[data-market="crypto"].active { background: #ffd700; border-bottom-color: #daa520; }
        .tab-button.active {
            transform: translateY(-2px);
            box-shadow: 0 -4px 8px rgba(180,100,40,0.2);
        }

        .card {
            background: #faf0da;
            border-radius: 28px;
            padding: 28px;
            margin-bottom: 28px;
            box-shadow: 0 12px 28px rgba(110, 70, 30, 0.25);
            border: 1px solid #dbbd9a;
        }
        h1 {
            font-weight: 400;
            font-size: 2.6rem;
            margin: 0 0 6px 0;
            color: #6b4a2c;
            border-left: 8px solid #b85e3a;
            padding-left: 22px;
            letter-spacing: -0.5px;
        }
        .subtitle {
            color: #8b6f50;
            margin-bottom: 32px;
            font-size: 1.1rem;
            padding-left: 30px;
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }
        .card-header h2 {
            margin: 0;
            font-weight: 400;
            color: #7b593a;
            font-size: 1.9rem;
        }
        .update-panel {
            display: flex;
            gap: 18px;
            align-items: center;
            background: #e7d7bd;
            padding: 8px 22px;
            border-radius: 60px;
            font-size: 1rem;
            color: #4f3a24;
            border: 1px solid #c7a87e;
            flex-wrap: wrap;
        }
        .update-panel span {
            color: #7b5b3a;
        }
        .badge {
            background: #c97c4d;
            color: #faefda;
            padding: 4px 16px;
            border-radius: 40px;
            font-weight: 600;
        }
        button {
            background: #b85e3a;
            border: none;
            color: #fef3e0;
            padding: 8px 24px;
            border-radius: 40px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: 0.15s;
            border: 1px solid #e19b72;
            box-shadow: 0 2px 6px rgba(150, 70, 20, 0.3);
        }
        button:hover {
            background: #c5704a;
            border-color: #f0b48b;
        }
        button:active {
            background: #9f4f2e;
        }
        
        .autosave-status {
            font-size: 0.8rem;
            color: #6b8e23;
            margin-left: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.95rem;
            background: #fcf5e8;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 6px 14px rgba(130, 80, 40, 0.15);
        }
        th {
            text-align: left;
            padding: 16px 10px;
            background: #e1cdb0;
            color: #4d3622;
            font-weight: 500;
            letter-spacing: 0.3px;
            border-bottom: 2px solid #b5926b;
        }
        td {
            padding: 14px 10px;
            border-bottom: 1px solid #e0cbb0;
            background: #fcf5e8;
            vertical-align: middle;
        }
        .color-indicator {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
            border: 1px solid rgba(0,0,0,0.2);
        }
        .price-table td:first-child {
            font-weight: 600;
        }
        .spark {
            width: 120px;
            height: 40px;
            display: block;
        }
        .spark svg {
            width: 100%;
            height: 100%;
            stroke: #9d6b4a;
            stroke-width: 2;
            fill: none;
        }
        .events-container {
            background: #eadccb;
            border-radius: 20px;
            padding: 16px 20px;
            border: 1px solid #ccb494;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }
        .event-item {
            padding: 10px;
            border-bottom: 1px dashed #b5926b;
            color: #4d3622;
            font-size: 0.95rem;
        }
        .event-item:last-child {
            border-bottom: none;
        }
        .event-high {
            color: #b85e3a;
            font-weight: 600;
        }
        .event-low {
            color: #3f6b4f;
            font-weight: 600;
        }
        .trade-table-container {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 24px;
            border: 1px solid #dabd9a;
            background: #faf0da;
        }
        .corp-list {
            display: flex;
            flex-wrap: wrap;
            gap: 24px 48px;
            background: #eadccb;
            padding: 24px;
            border-radius: 28px;
            border: 1px solid #ccb494;
        }
        .corp-group strong {
            color: #7b4f2c;
            display: block;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .corp-group ul {
            list-style-type: "‚ñ∏ ";
            padding-left: 24px;
            color: #634d34;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        .footer-note {
            color: #927b60;
            margin-top: 18px;
            font-size: 0.9rem;
            text-align: right;
        }
        .api-error {
            background: #b85e3a;
            color: #faefda;
            padding: 12px 24px;
            border-radius: 40px;
            font-weight: 600;
            margin-bottom: 20px;
            display: none;
            text-align: center;
            border: 2px solid #ffaa00;
        }
        .editable-name {
            cursor: pointer;
            border-bottom: 1px dashed #9b7b5a;
        }
        .edit-input {
            width: 150px;
            padding: 4px 8px;
            border: 1px solid #b85e3a;
            border-radius: 20px;
            background: #fff8e7;
            font-size: 0.95rem;
        }
        .buy-btn, .sell-btn {
            padding: 4px 10px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: 0.15s;
            margin: 1px;
        }
        .buy-btn {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #3a2800;
        }
        .buy-btn:hover { background: linear-gradient(135deg, #ffe44d, #ffbb33); transform: scale(1.05); }
        .sell-btn {
            background: linear-gradient(135deg, #44cc66, #22aa44);
            color: #fff;
        }
        .sell-btn:hover { background: linear-gradient(135deg, #66dd88, #33bb55); transform: scale(1.05); }
        .trade-msg {
            position: fixed; bottom: 20px; right: 20px;
            background: rgba(0,0,0,0.85); color: #ffd700;
            padding: 12px 24px; border-radius: 12px;
            font-size: 1.1rem; z-index: 99999;
            border: 1px solid #ffd700;
            animation: fadein 0.3s;
        }
        @keyframes fadein { from {opacity:0;transform:translateY(10px);} to {opacity:1;transform:translateY(0);} }
    </style>
</head>
<body>
<div class="container">
    <h1>‚ö° –≠–õ–ò–¢–ê: –¢–Å–ú–ù–´–ô –§–†–û–ù–¢–ò–† ‚Äì –í–ï–†–§–ò –ü–†–û–ú–´–®–õ–ï–ù–ù–û–°–¢–ò</h1>
    <div class="subtitle">–±–∏—Ä–∂–µ–≤—ã–µ –ø–ª–æ—â–∞–¥–∫–∏ —Å–µ–∫—Ç–æ—Ä–∞ "–û—Ö—Ä–∏—Å—Ç–∞—è —Ç—É–º–∞–Ω–Ω–æ—Å—Ç—å"</div>

    <div id="api-error" class="api-error" style="display:none;">‚ö†Ô∏è –ü—Ä–∏–≤—è–∑–∫–∞ –∫ CoinGecko –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∏–≥—Ä–æ–≤—ã–µ —Ü–µ–Ω—ã ‚ö†Ô∏è</div>

    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div class="tabs" id="marketTabs">
        <button class="tab-button active" data-market="mining">‚õèÔ∏è –î–æ–±—ã—á–∞</button>
        <button class="tab-button" data-market="energy">‚ö° –≠–Ω–µ—Ä–≥–∏—è</button>
        <button class="tab-button" data-market="bio">üß¨ –ë–∏–æ</button>
        <button class="tab-button" data-market="industry">üè≠ –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å</button>
        <button class="tab-button" data-market="data">üìÄ –î–∞–Ω–Ω—ã–µ</button>
        <button class="tab-button" data-market="crypto">ü™ô –ö—Ä–∏–ø—Ç–æ</button>
    </div>

    <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    <div id="market-content">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Å–æ–±—ã—Ç–∏–π -->
        <div class="card">
            <div class="card-header">
                <h2 id="events-title">üì° –°–æ–±—ã—Ç–∏—è –¥–æ–±—ã—á–∏</h2>
                <span class="badge" style="background:#8b6f50;">—Ç–µ–∫—É—â–∏–π —á–∞—Å</span>
            </div>
            <div class="events-container" id="eventsList">
                <div class="event-item">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</div>
            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ -->
        <div class="card">
            <div class="card-header">
                <h2 id="market-title">üìà –ö–æ—Ç–∏—Ä–æ–≤–∫–∏ –º–∞—Ç–µ—Ä–∏–∏</h2>
                <div class="update-panel">
                    <span>üïí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: <span id="last-update-time">‚Äî</span></span>
                    <span class="badge" id="next-update">10:00</span>
                    <button id="manual-update">‚ü≥ –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–π—á–∞—Å</button>
                    <span id="autosave-status" class="autosave-status">‚úÖ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</span>
                </div>
            </div>
            <div style="overflow-x: auto;">
                <table class="price-table" id="price-table">
                    <thead>
                    <tr>
                        <th>–†–µ—Å—É—Ä—Å</th>
                        <th>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ (‚Ç°)</th>
                        <th>–ò–≥—Ä–æ–≤–∞—è —Ü–µ–Ω–∞ (‚Ç°)</th>
                        <th>–ì—Ä–∞—Ñ–∏–∫ ¬∑ 30 –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</th>
                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                    </tr>
                    </thead>
                    <tbody id="price-table-body">
                    <tr><td colspan="4" style="text-align:center;">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –õ–µ–Ω—Ç–∞ —Å–¥–µ–ª–æ–∫ -->
        <div class="card">
            <h2 id="trades-title">üìú –°–¥–µ–ª–∫–∏ —Å –¥–æ–±—ã—á–µ–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü</h2>
            <div class="trade-table-container">
                <table id="trade-table">
                    <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è (UTC)</th>
                        <th>–†–µ—Å—É—Ä—Å</th>
                        <th>–ü—Ä–æ–¥–∞–≤–µ—Ü</th>
                        <th>–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</th>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th>–¶–µ–Ω–∞/–µ–¥ (‚Ç°)</th>
                        <th>–°—É–º–º–∞ (‚Ç°)</th>
                    </tr>
                    </thead>
                    <tbody id="trade-table-body">
                    <tr><td colspan="7" style="text-align:center;">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏ -->
        <div class="card">
            <h2>üè≠ –ö–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏ –∏ –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è</h2>
            <div class="corp-list" id="corp-list"></div>
            <div class="footer-note">* —Å–¥–µ–ª–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –º–µ–∂–¥—É –¥–æ—á–µ—Ä–Ω–∏–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏</div>
        </div>
    </div>
</div>

<script>
(function() {
    // ================== –û–ë–©–ò–ï –î–ê–ù–ù–´–ï ==================
    const cryptoPool = [
        "bitcoin", "ethereum", "solana", "dogecoin", "chainlink",
        "matic-network", "litecoin", "ripple", "cardano", "binancecoin"
    ];

    const corporations = [
        { name: "Wayland-Ares Systems", subs: ["WAS ENERGY", "WAS DATA", "WAS PROM", "WAS BIO", "WAS MINING"] },
        { name: "Akasaka Group", subs: ["AKS ENERGY", "AKS DATA", "AKS PROM", "AKS BIO", "AKS MINING"] },
        { name: "USSR", subs: ["USR ENERGY", "USR DATA", "USR PROM", "USR BIO", "USR MINING"] },
        { name: "MARS INC", subs: ["MRS ENERGY", "MRS DATA", "MRS PROM", "MRS BIO", "MRS MINING"] },
        { name: "ROBOTS SYSTEM", subs: ["RBS ENERGY", "RBS DATA", "RBS PROM", "RBS BIO", "RBS MINING"] }
    ];

    const allSubs = corporations.flatMap(corp => corp.subs.map(sub => `${corp.name} / ${sub}`));

    // ================== –ì–ï–ù–ï–†–ê–¶–ò–Ø –¶–í–ï–¢–û–í ==================
    function getColorForIndex(index, market) {
        if (market === 'mining') {
            const colors = [
                '#8B7E6A', '#A0522D', '#5D8C6B', '#796878', '#6B4F47', '#4A5D5E', '#7C6E65', '#5E5A4B',
                '#9D8174', '#6A7C7A', '#8F6A4F', '#6F5E53', '#4E6159', '#756650', '#6A5D5D', '#7B6B61',
                '#8C7A6B', '#5A6F68', '#7F6B5E', '#6B554B', '#4E6252', '#7B685C', '#6C5E4D', '#5D6B6C',
                '#7A6459', '#6F5B4B', '#5E6A5C', '#7F6A5A', '#6D5C55', '#4F625B', '#806B60', '#6A5C50',
                '#5F6B5F', '#7E6A5C', '#6F5D4E', '#5F655B', '#7C685B', '#695E51', '#5C685B', '#7B675A',
                '#675F54', '#5C665A', '#776457', '#655B4E', '#5B6558', '#756256', '#615B51', '#5C6256'
            ];
            return colors[index % colors.length];
        } else if (market === 'energy') {
            return `hsl(${190 + (index * 7) % 40}, 70%, 70%)`;
        } else if (market === 'bio') {
            return `hsl(${90 + (index * 5) % 50}, 80%, 70%)`;
        } else if (market === 'industry') {
            return `hsl(${200 + (index * 6) % 40}, 80%, 70%)`;
        } else if (market === 'data') {
            return `hsl(${280 + (index * 8) % 60}, 80%, 75%)`;
        } else if (market === 'crypto') {
            return `hsl(${40 + (index * 12) % 50}, 90%, 60%)`;
        }
        return '#cccccc';
    }

    // ================== –°–ü–ò–°–û–ö –ú–ò–ù–ï–†–ê–õ–û–í (–¥–ª—è –¥–æ–±—ã—á–∏) ==================
    const mineralNames = [
        "–í–æ–¥–æ—Ä–æ–¥", "–ì–µ–ª–∏–π-3", "–î–µ–π—Ç–µ—Ä–∏–π", "–¢—Ä–∏—Ç–∏–π", "–õ–∏—Ç–∏–π", "–ë–µ—Ä–∏–ª–ª–∏–π", "–ë–æ—Ä", "–£–≥–ª–µ—Ä–æ–¥", "–ê–∑–æ—Ç", "–ö–∏—Å–ª–æ—Ä–æ–¥",
        "–§—Ç–æ—Ä", "–ù–µ–æ–Ω", "–ù–∞—Ç—Ä–∏–π", "–ú–∞–≥–Ω–∏–π", "–ê–ª—é–º–∏–Ω–∏–π", "–ö—Ä–µ–º–Ω–∏–π", "–§–æ—Å—Ñ–æ—Ä", "–°–µ—Ä–∞", "–•–ª–æ—Ä", "–ê—Ä–≥–æ–Ω",
        "–ö–∞–ª–∏–π", "–ö–∞–ª—å—Ü–∏–π", "–°–∫–∞–Ω–¥–∏–π", "–¢–∏—Ç–∞–Ω", "–í–∞–Ω–∞–¥–∏–π", "–•—Ä–æ–º", "–ú–∞—Ä–≥–∞–Ω–µ—Ü", "–ñ–µ–ª–µ–∑–æ", "–ö–æ–±–∞–ª—å—Ç", "–ù–∏–∫–µ–ª—å",
        "–ú–µ–¥—å", "–¶–∏–Ω–∫", "–ì–∞–ª–ª–∏–π", "–ì–µ—Ä–º–∞–Ω–∏–π", "–ú—ã—à—å—è–∫", "–°–µ–ª–µ–Ω", "–ë—Ä–æ–º", "–ö—Ä–∏–ø—Ç–æ–Ω", "–†—É–±–∏–¥–∏–π", "–°—Ç—Ä–æ–Ω—Ü–∏–π",
        "–ò—Ç—Ç—Ä–∏–π", "–¶–∏—Ä–∫–æ–Ω–∏–π", "–ù–∏–æ–±–∏–π", "–ú–æ–ª–∏–±–¥–µ–Ω", "–†—É—Ç–µ–Ω–∏–π", "–†–æ–¥–∏–π", "–ü–∞–ª–ª–∞–¥–∏–π", "–°–µ—Ä–µ–±—Ä–æ", "–ö–∞–¥–º–∏–π", "–ò–Ω–¥–∏–π",
        "–û–ª–æ–≤–æ", "–°—É—Ä—å–º–∞", "–¢–µ–ª–ª—É—Ä", "–ô–æ–¥", "–ö—Å–µ–Ω–æ–Ω", "–¶–µ–∑–∏–π", "–ë–∞—Ä–∏–π", "–õ–∞–Ω—Ç–∞–Ω", "–¶–µ—Ä–∏–π", "–ü—Ä–∞–∑–µ–æ–¥–∏–º",
        "–ù–µ–æ–¥–∏–º", "–°–∞–º–∞—Ä–∏–π", "–ï–≤—Ä–æ–ø–∏–π", "–ì–∞–¥–æ–ª–∏–Ω–∏–π", "–¢–µ—Ä–±–∏–π", "–î–∏—Å–ø—Ä–æ–∑–∏–π", "–ì–æ–ª—å–º–∏–π", "–≠—Ä–±–∏–π", "–¢—É–ª–∏–π", "–ò—Ç—Ç–µ—Ä–±–∏–π",
        "–õ—é—Ç–µ—Ü–∏–π", "–ì–∞—Ñ–Ω–∏–π", "–¢–∞–Ω—Ç–∞–ª", "–í–æ–ª—å—Ñ—Ä–∞–º", "–†–µ–Ω–∏–π", "–û—Å–º–∏–π", "–ò—Ä–∏–¥–∏–π", "–ü–ª–∞—Ç–∏–Ω–∞", "–ó–æ–ª–æ—Ç–æ", "–†—Ç—É—Ç—å",
        "–¢–∞–ª–ª–∏–π", "–°–≤–∏–Ω–µ—Ü", "–í–∏—Å–º—É—Ç", "–¢–æ—Ä–∏–π", "–£—Ä–∞–Ω", "–ü–ª—É—Ç–æ–Ω–∏–π"
    ];

    // ================== –ü–û–°–¢–†–û–ï–ù–ò–ï –†–ï–°–£–†–°–û–í ==================
    // –î–æ–±—ã—á–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ü–µ–Ω—ã)
    function buildMiningResources() {
        const mineralPrices = [
            5, 8, 12, 15, 20, 25, 18, 10, 6, 7,
            22, 24, 28, 30, 35, 32, 26, 18, 12, 14,
            40, 45, 50, 55, 48, 38, 42, 30, 60, 70,
            80, 45, 90, 100, 25, 30, 20, 18, 220, 35,
            150, 85, 95, 110, 180, 250, 300, 200, 55, 70,
            65, 28, 40, 22, 16, 60, 75, 80, 120, 140,
            160, 165, 170, 175, 180, 185, 190, 195, 200, 205,
            210, 215, 220, 225, 230, 235, 240, 1600, 1800, 50,
            40, 20, 18, 22, 25, 28, 32, 35, 38, 42,
            350, 400, 500
        ];
        let res = mineralNames.map((name, index) => ({
            name: name,
            cryptoId: cryptoPool[index % cryptoPool.length],
            basePrice: mineralPrices[index] || 30,
            isExotic: false
        }));
        res.push(
            { name: "–¢—ë–º–Ω–∞—è –º–∞—Ç–µ—Ä–∏—è", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–ö–≤–∞—Ä–∫–æ–≤—ã–π –∫–æ–Ω–¥–µ–Ω—Å–∞—Ç", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–ù—É–ª—å-–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ", isExotic: true, basePrice: 9999, cryptoId: null }
        );
        return res;
    }

    // –≠–Ω–µ—Ä–≥–∏—è (–Ω–æ–≤–∞—è —Ç–µ–æ—Ä–∏—è)
    function buildEnergyResources() {
        const names = [
            "–ö–≤–∞–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ (‚à´Œ∏dt)",
            "–í—è–∑–∫–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–∏ (Œµ)",
            "–ó–æ–ª–æ—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ (œÜ)",
            "–≠–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (exp(œÜ/Œµ))",
            "–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–∏—Ç–Ω–∞—è —Å–≤—è–∑—å (Œ±‚Åª¬π)",
            "–ü—Ä–æ—Ç–æ–Ω-—ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å (mp/me)",
            "–≠–Ω–µ—Ä–≥–∏—è —Å–∂–∞—Ç–∏—è (mb)",
            "–ò–µ—Ä–∞—Ä—Ö–∏—è —Å–∏–ª (—ç–ª–µ–∫—Ç—Ä–æ–º–∞–≥–Ω–µ—Ç–∏–∑–º)",
            "–ò–µ—Ä–∞—Ä—Ö–∏—è —Å–∏–ª (—Å–∏–ª—å–Ω–∞—è)",
            "–ò–µ—Ä–∞—Ä—Ö–∏—è —Å–∏–ª (—Å–ª–∞–±–∞—è)",
            "–ì—Ä–∞–≤–∏—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª (G)",
            "–°–ø–∏—Ä–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è –§–∏–±–æ–Ω–∞—á—á–∏",
            "–°–∞–º–æ-–≤–ª–æ–∂–µ–Ω–Ω–∞—è –ø—Ä–æ–µ–∫—Ü–∏—è",
            "–ö–≤–∞–Ω—Ç–æ–≤–∞—è –ø–µ–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏",
            "–¢—ë–º–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è (—Ñ–æ–Ω–æ–≤–∞—è)",
            "–≠–Ω–µ—Ä–≥–∏—è –≤–∞–∫—É—É–º–∞ (–Ω—É–ª–µ–≤–∞—è)",
            "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —ç–Ω—Ç—Ä–æ–ø–∏—è",
            "–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏",
            "–°–∂–∞—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø—Ä–∏ –ø—Ä–æ–µ–∫—Ü–∏–∏",
            "–î—Ä–µ–π—Ñ –∫–æ–Ω—Å—Ç–∞–Ω—Ç (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è)",
            "–û—Å—Ç—ã–≤–∞—é—â–∏–π –∏–Ω—Å—Ç–∞–Ω—Å",
            "–ò–¥–µ–∞–ª—å–Ω–∞—è –≥–µ–æ–º–µ—Ç—Ä–∏—è (—Å–ª–µ–¥)",
            "–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–≤—è–∑–∫–∞ œÜ-Œµ",
            "–≠–Ω–µ—Ä–≥–∏—è –∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞",
            "–§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è —Å–ø–∏—Ä–∞–ª—å"
        ];
        let res = names.map((name, idx) => ({
            name: name,
            cryptoId: cryptoPool[idx % cryptoPool.length],
            basePrice: 30 + idx * 19,
            isExotic: false
        }));
        res.push(
            { name: "–ü–µ—Ä–≤–∏—á–Ω—ã–π œÜ-–∫—Ä–∏—Å—Ç–∞–ª–ª (—á–∏—Å—Ç–æ–µ —Å–µ—á–µ–Ω–∏–µ)", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–°–∏–Ω–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å Œµ (—Ç–æ—á–∫–∞ —Å–∞–º–æ-–≤–ª–æ–∂–µ–Ω–∏—è)", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–ê—Ä—Ç–µ—Ñ–∞–∫—Ç –ø–æ–ª–Ω–æ–π —Å–ø–∏—Ä–∞–ª–∏ –§–∏–±–æ–Ω–∞—á—á–∏", isExotic: true, basePrice: 9999, cryptoId: null }
        );
        return res;
    }

    // –ë–∏–æ
    function buildBioResources() {
        const names = [
            "–°–ø–æ—Ä—ã –≥—Ä–∏–±–Ω–∏—Ü—ã", "–§–µ—Ä–æ–º–æ–Ω—ã –Ω–∞—Å–µ–∫–æ–º—ã—Ö", "–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ç–µ—Ä–∏–∞–ª –∏–Ω—Å–µ–∫—Ç–æ–∏–¥–æ–≤", "–ö–ª–µ—Ç–∫–∏ –∫–æ—Å—Ç–Ω–æ–≥–æ –º–æ–∑–≥–∞",
            "–î–ù–ö –¥—Ä–µ–≤–Ω–∏—Ö —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–π", "–õ–µ–∫–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç—Ä–∞–≤—ã –§–æ—Ä—Ç—É–Ω—ã 72", "–ê–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–∏ —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞", "–í–∏—Ä—É—Å—ã-–º—É—Ç–∞–≥–µ–Ω—ã",
            "–°—ã–≤–æ—Ä–æ—Ç–∫–∞ –¥–æ–ª–≥–æ–ª–µ—Ç–∏—è", "–°—Ç–∏–º—É–ª—è—Ç–æ—Ä—ã —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏", "–û—Ä–≥–∞–Ω—ã –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–ª–∞–Ω—Ç–∞—Ü–∏–∏", "–Ø–¥—ã –∏ –∞–Ω—Ç–∏–¥–æ—Ç—ã",
            "–ì–æ—Ä–º–æ–Ω—ã —Ä–æ—Å—Ç–∞", "–ù–µ–π—Ä–æ–º–µ–¥–∏–∞—Ç–æ—Ä—ã", "–≠–ª–∏–∫—Å–∏—Ä—ã –∫–≤–∞–Ω—Ç–æ–≤–æ–≥–æ –ø—Å–∏—Ö–æ–∑–∞", "–ë–∞–∫—Ç–µ—Ä–∏–∏ –∏–∑ —Ç—ë–º–Ω–æ–π –º–∞—Ç–µ—Ä–∏–∏",
            "–°–∏–º–±–∏–æ—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–¥–æ—Ä–æ—Å–ª–∏", "–°–ø–æ—Ä—ã –æ–±—ä–µ–¥–∏–Ω—è—é—â–µ–π –≥—Ä–∏–±–Ω–∏—Ü—ã", "–ú–µ—Å–∫–∞–ª–∏–Ω –∏–∑ —Ä–∞—Å—Ç–µ–Ω–∏–π –î–µ–∞–¥–µ–º—ã", "–ö—Ä–æ–≤—å —Ä–∞–∑—É–º–Ω—ã—Ö –∫–æ—à–µ–∫",
            "–¢–∫–∞–Ω–∏ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É—é—â–∏—Ö —Å—É—â–µ—Å—Ç–≤", "–ü–∞–Ω—Ü–∏—Ä–∏ —Ö–∏—Ç–∏–Ω–æ–≤—ã—Ö —Å—É—â–µ—Å—Ç–≤", "–°–ª–∏–∑—å –ª–µ—á–µ–±–Ω—ã—Ö –º–æ–ª–ª—é—Å–∫–æ–≤", "–≠–Ω–∑–∏–º—ã —Ç–µ—Ä–º–∞–ª—å–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤",
            "–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã"
        ];
        let res = names.map((name, idx) => ({
            name: name,
            cryptoId: cryptoPool[idx % cryptoPool.length],
            basePrice: 25 + idx * 18,
            isExotic: false
        }));
        res.push(
            { name: "–ü—Ä–æ—Ç–æ–º–∏—Ü–µ–ª–∏–π –≤—Å–µ–ø–ª–∞–Ω–µ—Ç–Ω–æ–π –≥—Ä–∏–±–Ω–∏—Ü—ã", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–≠–ª–∏–∫—Å–∏—Ä –∏—Å—Ç–∏–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–æ–ª–µ—Ç–∏—è", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–ì–µ–Ω –∞–±—Å–æ–ª—é—Ç–Ω–æ–π –ø–∞–º—è—Ç–∏", isExotic: true, basePrice: 9999, cryptoId: null }
        );
        return res;
    }

    // ================== –ù–û–í–ê–Ø –ü–†–û–ú–´–®–õ–ï–ù–ù–û–°–¢–¨ (–∫–æ—Ä–∞–±–ª–∏ –∏ —Å—Ç–∞–Ω—Ü–∏–∏) ==================
    function buildIndustryResources() {
        // ---- –î–∞–Ω–Ω—ã–µ –∏–∑ —Ç—Ä—ë—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ ----
        // –ò–º–µ–Ω–∞ –∫–æ—Ä–∞–±–ª–µ–π (–∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞)
        const shipNames = [
            "–ö–û–ë–†–ê", "–®–ù–´–†–¨", "–î–ï–†–ó–ö–ò–ô", "–ë–£–ù–¢", "–ö–ò–ù–ñ–ê–õ", "–ü–ï–ì–ê–°", "–û–†–ò–û–ù",
            "–ö–û–†–í–ï–¢", "–£–ù–ò–í–ï–†–°–ê–õ", "–ë–ê–†–•–ê–ù", "–ò–ö–ê–†–£–°", "–ê–¢–õ–ê–ù–¢", "–î–ê–ú–ò–†", "–ë–£–†–ê–ù"
        ];
        // –ú–æ–¥—É–ª–∏ –∫–æ—Ä–∞–±–ª—è (—Ç–æ–ª—å–∫–æ stats, –Ω–∞–º –Ω—É–∂–Ω–æ –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ–≥–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –Ω–æ –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º)
        const shipModulesStats = [
            { speed:1, mining:1, fuel:1, health:1, shield:1 },   // 0
            { speed:1, mining:1, fuel:0, health:0, shield:0 },   // 1
            { speed:1, mining:0, fuel:1, health:0, shield:0 },   // 2
            { speed:1, mining:0, fuel:0, health:1, shield:0 },   // 3
            { speed:0, mining:0, fuel:0, health:0, shield:1 },   // 4
            { speed:0, mining:1, fuel:1, health:0, shield:0 },   // 5
            { speed:0, mining:1, fuel:0, health:1, shield:0 },   // 6
            { speed:0, mining:0, fuel:0, health:0, shield:1 },   // 7
            { speed:0, mining:0, fuel:1, health:1, shield:0 },   // 8
            { speed:0, mining:0, fuel:0, health:0, shield:1 },   // 9
            { speed:0, mining:0, fuel:0, health:1, shield:1 },   // 10
            { speed:1, mining:0, fuel:0, health:0, shield:0 },   // 11
            { speed:0, mining:1, fuel:0, health:0, shield:0 },   // 12
            { speed:0, mining:0, fuel:1, health:0, shield:0 }    // 13
        ];

        // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä (–∏–º–µ–Ω–∞ –∏ —Å—Ç–∞—Ç—ã –∏–∑ VERSION_DATA)
        const transporterData = [
            { name: "–ö–£–†–¨–ï–†",    stats: { storage:1, defense:1, wormholeSpeed:1, quantumCalc:1, insurance:1 } },
            { name: "–ì–†–£–ó–û–í–ò–ö",  stats: { storage:2, defense:1, wormholeSpeed:2, quantumCalc:1, insurance:2 } },
            { name: "–¢–Ø–ì–ê–ß",     stats: { storage:3, defense:2, wormholeSpeed:2, quantumCalc:2, insurance:2 } },
            { name: "–õ–ò–•–¢–ï–†",    stats: { storage:4, defense:2, wormholeSpeed:3, quantumCalc:2, insurance:3 } },
            { name: "–ë–ê–õ–ö–ï–†",    stats: { storage:5, defense:3, wormholeSpeed:3, quantumCalc:3, insurance:3 } },
            { name: "–ö–ê–†–ê–í–ê–ù",   stats: { storage:6, defense:3, wormholeSpeed:4, quantumCalc:3, insurance:4 } },
            { name: "–õ–ï–í–ò–ê–§–ê–ù",  stats: { storage:7, defense:4, wormholeSpeed:4, quantumCalc:4, insurance:4 } }
        ];

        // –°—Ç–∞–Ω—Ü–∏—è (–∏–º–µ–Ω–∞ –∏ –º–æ–¥—É–ª–∏ —Å–æ stats)
        const stationNames = [
            "–û–°–ù–û–í–ê", "–£–ó–ï–õ", "–ö–û–õ–¨–¶–û", "–°–ü–ò–†–ê–õ–¨", "–ö–õ–ê–°–¢–ï–†", "–§–û–†–ü–û–°–¢", "–ö–û–ú–ü–õ–ï–ö–°",
            "–ê–†–ö–ê", "–°–§–ï–†–ê", "–¶–ò–¢–ê–î–ï–õ–¨", "–ú–ï–ì–ê–ü–û–õ–ò–°", "–ò–ú–ü–ï–†–ò–Ø", "–ö–û–õ–û–ù–ò–Ø", "–û–õ–ò–ú–ü"
        ];
        const stationModulesStats = [
            { storage:1, energy:1, population:0, defense:1, research:0 }, // 0
            { storage:1, energy:0, population:1, defense:0, research:0 }, // 1
            { storage:0, energy:1, population:0, defense:0, research:1 }, // 2
            { storage:1, energy:1, population:0, defense:0, research:0 }, // 3
            { storage:0, energy:1, population:0, defense:1, research:0 }, // 4
            { storage:1, energy:0, population:1, defense:0, research:1 }, // 5
            { storage:1, energy:1, population:0, defense:1, research:0 }, // 6
            { storage:0, energy:0, population:1, defense:0, research:1 }, // 7
            { storage:1, energy:1, population:1, defense:0, research:0 }, // 8
            { storage:0, energy:0, population:1, defense:1, research:0 }, // 9
            { storage:1, energy:1, population:0, defense:0, research:1 }, // 10
            { storage:0, energy:1, population:0, defense:1, research:1 }, // 11
            { storage:1, energy:0, population:1, defense:1, research:0 }, // 12
            { storage:1, energy:1, population:1, defense:1, research:1 }  // 13
        ];

        // ---- –§–æ—Ä–º–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤ —Ä–µ—Å—É—Ä—Å–æ–≤ ----
        let resources = [];

        // –ö–æ—Ä–∞–±–ª–∏ (—É—Ä–æ–≤–Ω–∏ 1..14)
        for (let i = 0; i < shipNames.length; i++) {
            resources.push({
                name: `üõ∏ ${shipNames[i]}`,
                cryptoId: cryptoPool[resources.length % cryptoPool.length],
                basePrice: 2000 + i * 300,   // –æ—Ç 2000 –¥–æ 5900
                isExotic: false
            });
        }

        // –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä—ã (—É—Ä–æ–≤–Ω–∏ 1..7)
        for (let i = 0; i < transporterData.length; i++) {
            resources.push({
                name: `üöö ${transporterData[i].name}`,
                cryptoId: cryptoPool[resources.length % cryptoPool.length],
                basePrice: 2500 + i * 500,   // –æ—Ç 2500 –¥–æ 5500
                isExotic: false
            });
        }

        // –°—Ç–∞–Ω—Ü–∏–∏ (—É—Ä–æ–≤–Ω–∏ 1..14)
        for (let i = 0; i < stationNames.length; i++) {
            resources.push({
                name: `üõ∞Ô∏è ${stationNames[i]}`,
                cryptoId: cryptoPool[resources.length % cryptoPool.length],
                basePrice: 3000 + i * 400,   // –æ—Ç 3000 –¥–æ 8200
                isExotic: false
            });
        }

        // –≠–∫–∑–æ—Ç–∏–∫–∞ (—Ç—Ä–∏ —Ä–µ–¥–∫–∏—Ö –∫–æ—Ä–∞–±–ª—è/—Å—Ç–∞–Ω—Ü–∏–∏)
        resources.push(
            { name: "üöÄ –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–π –∫–ª–∏–ø–µ—Ä '–ù–µ–º–µ–∑–∏–¥–∞'", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "üêâ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ—Ä '–ö—Ä–∞–∫–µ–Ω'", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "üèõÔ∏è –°—Ç–∞–Ω—Ü–∏—è '–í–∞–≤–∏–ª–æ–Ω'", isExotic: true, basePrice: 9999, cryptoId: null }
        );

        return resources;
    }

    // –î–∞–Ω–Ω—ã–µ
    function buildDataResources() {
        const names = [
            "–ö—Ä–∏—Å—Ç–∞–ª–ª—ã –ø–∞–º—è—Ç–∏", "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≥–µ–Ω–æ–º–æ–≤", "–ê—Ä—Ö–∏–≤—ã –ò–º–ø–µ—Ä–∏–∏", "–ö–∞—Ä—Ç—ã –∑–≤—ë–∑–¥–Ω—ã—Ö —Å–∏—Å—Ç–µ–º",
            "–ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö", "–õ–æ–≥–∏ –¥–µ–º–∏—É—Ä–≥–æ–≤", "–ê–ª–≥–æ—Ä–∏—Ç–º—ã –ò–ò", "–ù–µ–π—Ä–æ—Å–µ—Ç–µ–≤—ã–µ –º–∞—Ç—Ä–∏—Ü—ã",
            "–ó–∞–ø–∏—Å–∏ —Å–µ–Ω—Å–æ—Ä–æ–≤", "–ö–∞—Ç–∞–ª–æ–≥–∏ –º–∏–Ω–µ—Ä–∞–ª–æ–≤", "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –±–∞–∑—ã", "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —á–µ—Ä—Ç–µ–∂–∏",
            "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–∏", "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ —Ö—Ä–æ–Ω–∏–∫–∏", "–ö–≤–∞–Ω—Ç–æ–≤—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è", "–≠–º—É–ª—è—Ç–æ—Ä—ã —Å–æ–∑–Ω–∞–Ω–∏—è",
            "–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã", "–í–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ —Å –ø–ª–∞–Ω–µ—Ç", "–î–∞–Ω–Ω—ã–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏", "–°–Ω—ã –∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è",
            "–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –º–æ–ª–∏—Ç–≤", "–ë–∏—Ä–∂–µ–≤—ã–µ –∫–æ—Ç–∏—Ä–æ–≤–∫–∏", "–ê—Ä—Ö–∏–≤—ã –Ω–æ–≤–æ—Å—Ç–µ–π", "–õ–∏—á–Ω—ã–µ –¥–Ω–µ–≤–Ω–∏–∫–∏ –∫–æ–ª–æ–Ω–∏—Å—Ç–æ–≤",
            "–°–∏—Å—Ç–µ–º—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è"
        ];
        let res = names.map((name, idx) => ({
            name: name,
            cryptoId: cryptoPool[idx % cryptoPool.length],
            basePrice: 20 + idx * 17,
            isExotic: false
        }));
        res.push(
            { name: "–ü–µ—Ä–≤–∞—è –ø–µ—á–∞—Ç—å (–ª–æ–≥–æ—Å –¥–µ–º–∏—É—Ä–≥–æ–≤)", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–°–ª–µ–ø–æ–∫ –¥—É—à–∏ —Ä–æ–±–æ—Ç–∞-–º–æ–Ω–∞—Ö–∞", isExotic: true, basePrice: 9999, cryptoId: null },
            { name: "–ê—Ä—Ö–∏–≤ –∏—Å—á–µ–∑–Ω—É–≤—à–µ–π —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏ –ü—Ä–∏–ø—è—Ç–∏-97", isExotic: true, basePrice: 9999, cryptoId: null }
        );
        return res;
    }

    // –ö—Ä–∏–ø—Ç–æ-—Ä–µ—Å—É—Ä—Å—ã (–≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ —Ä–µ–∞–ª—å–Ω—ã–º –º–æ–Ω–µ—Ç–∞–º —á–µ—Ä–µ–∑ CoinGecko)
    function buildCryptoResources() {
        const coins = [
            { name: 'ü™ô FrontierCoin (FRC)',  basePrice: 1200, cryptoId: 'bitcoin',  isExotic: false },
            { name: 'üíé AsteriteCoin (AST)',   basePrice: 340,  cryptoId: 'ethereum', isExotic: false },
            { name: '‚ö° PlasmaCred (PLC)',      basePrice: 85,   cryptoId: 'solana',   isExotic: false },
            { name: 'üîó ChainOre (CHO)',       basePrice: 52,   cryptoId: 'cardano',  isExotic: false },
            { name: 'üõ°Ô∏è ShieldToken (SHT)',    basePrice: 190,  cryptoId: 'polkadot', isExotic: false },
            { name: 'üöÄ HyperDrive (HDR)',     basePrice: 720,  cryptoId: 'avalanche-2', isExotic: false },
            { name: 'üåê NebulaBit (NBT)',      basePrice: 410,  cryptoId: 'chainlink', isExotic: false },
            { name: 'üîÆ QuantumCrypt (QTC)',    basePrice: 1500, cryptoId: 'dogecoin', isExotic: false },
            { name: 'üè¥ DarkMatter (DKM)',     basePrice: 2800, cryptoId: null, isExotic: true },
            { name: '‚≠ê StellarCredit (STC)',   basePrice: 95,   cryptoId: 'stellar', isExotic: false },
            { name: 'üßä CryoVault (CRV)',      basePrice: 270,  cryptoId: 'cosmos', isExotic: false },
            { name: 'üî• FusionToken (FSN)',     basePrice: 620,  cryptoId: 'litecoin', isExotic: false },
            { name: 'üåë VoidCoin (VDC)',        basePrice: 3500, cryptoId: null, isExotic: true },
            { name: 'üì° SignalByte (SGB)',      basePrice: 145,  cryptoId: 'uniswap', isExotic: false },
            { name: 'üèóÔ∏è ForgeAlloy (FGA)',     basePrice: 380,  cryptoId: 'polygon', isExotic: false },
        ];
        return coins;
    }

    // ================== –°–û–°–¢–û–Ø–ù–ò–ï –†–´–ù–ö–û–í ==================
    let markets = {
        mining:   { name: '–î–æ–±—ã—á–∞', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} },
        energy:   { name: '–≠–Ω–µ—Ä–≥–∏—è', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} },
        bio:      { name: '–ë–∏–æ', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} },
        industry: { name: '–ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç—å', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} },
        data:     { name: '–î–∞–Ω–Ω—ã–µ', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} },
        crypto:   { name: '–ö—Ä–∏–ø—Ç–æ', resources: [], events: [], trades: [], priceHistory: [], currentPrices: {} }
    };

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let prevCryptoPrices = {};
    let currentMarket = 'mining';
    let apiError = false;
    let nextUpdateTime = Date.now() + 10 * 60 * 1000;
    let autosaveTimer = null;
    const STORAGE_KEY = 'elite_markets_v2';

    // ================== –°–û–•–†–ê–ù–ï–ù–ò–ï/–ó–ê–ì–†–£–ó–ö–ê ==================
    function saveToLocalStorage() {
        try {
            const config = {};
            for (let key in markets) {
                config[key] = {
                    name: markets[key].name,
                    resources: markets[key].resources.map(r => ({
                        name: r.name,
                        basePrice: r.basePrice,
                        isExotic: r.isExotic,
                        cryptoId: r.cryptoId
                    }))
                };
            }
            localStorage.setItem(STORAGE_KEY, JSON.stringify(config));
            document.getElementById('autosave-status').innerHTML = '‚úÖ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ ' + new Date().toLocaleTimeString();
        } catch (e) {
            console.warn('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', e);
        }
    }

    function loadFromLocalStorage() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (!saved) return false;
        try {
            const config = JSON.parse(saved);
            for (let key in config) {
                if (!markets[key]) continue;
                if (!config[key].resources || !Array.isArray(config[key].resources)) continue;
                markets[key].resources = config[key].resources.map(r => ({
                    ...r,
                    isExotic: r.isExotic || false
                }));
            }
            return true;
        } catch (e) {
            console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', e);
            return false;
        }
    }

    function initDefaultResources() {
        markets.mining.resources = buildMiningResources();
        markets.energy.resources = buildEnergyResources();
        markets.bio.resources = buildBioResources();
        markets.industry.resources = buildIndustryResources();
        markets.data.resources = buildDataResources();
        markets.crypto.resources = buildCryptoResources();
    }

    function ensureAllSectors() {
        if (!markets.mining.resources.length) markets.mining.resources = buildMiningResources();
        if (!markets.energy.resources.length) markets.energy.resources = buildEnergyResources();
        if (!markets.bio.resources.length) markets.bio.resources = buildBioResources();
        if (!markets.industry.resources.length) markets.industry.resources = buildIndustryResources();
        if (!markets.data.resources.length) markets.data.resources = buildDataResources();
        if (!markets.crypto.resources.length) markets.crypto.resources = buildCryptoResources();
    }

    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ü–≤–µ—Ç–∞ –∏ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    function applyColorsAndReset() {
        for (let key in markets) {
            markets[key].resources.forEach((r, idx) => {
                r.color = getColorForIndex(idx, key);
            });
            markets[key].priceHistory = markets[key].resources.map(() => []);
            markets[key].currentPrices = {};
            markets[key].events = [];
            markets[key].trades = [];
        }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–¥–µ–ª–æ–∫
    function initPricesAndTrades() {
        const defaultPrices = {
            'bitcoin': 65000, 'ethereum': 3500, 'solana': 140, 'dogecoin': 0.12,
            'chainlink': 14, 'matic-network': 0.9, 'litecoin': 80, 'ripple': 0.6,
            'cardano': 0.4, 'binancecoin': 300
        };
        cryptoPool.forEach(id => { prevCryptoPrices[id] = defaultPrices[id] || 100; });

        for (let key in markets) {
            const market = markets[key];
            market.resources.forEach((r, idx) => {
                if (r.isExotic) {
                    market.currentPrices[r.name] = 9999;
                    market.priceHistory[idx] = [9999];
                } else {
                    const base = r.basePrice;
                    const price = base * (0.9 + Math.random() * 0.2);
                    market.currentPrices[r.name] = Math.round(price * 100) / 100;
                    market.priceHistory[idx] = [market.currentPrices[r.name]];
                }
            });
            generateHistoricalTradesForMarket(key);
        }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö —Å–¥–µ–ª–æ–∫
    function generateHistoricalTradesForMarket(marketKey) {
        const market = markets[marketKey];
        const resources = market.resources;
        const now = Date.now();
        const thirtyDaysAgo = now - 30 * 24 * 60 * 60 * 1000;
        for (let i = 0; i < 500; i++) {
            const randTime = thirtyDaysAgo + Math.random() * (now - thirtyDaysAgo);
            const useExotic = Math.random() < 0.1;
            let res;
            if (useExotic) {
                const exoticResources = resources.filter(r => r.isExotic);
                if (exoticResources.length === 0) continue;
                res = exoticResources[Math.floor(Math.random() * exoticResources.length)];
            } else {
                const normalResources = resources.filter(r => !r.isExotic);
                res = normalResources[Math.floor(Math.random() * normalResources.length)];
            }
            const pastPrice = res.isExotic ? 9999 : (res.basePrice * (0.7 + Math.random() * 0.6));
            const gamePrice = Math.round(pastPrice * 100) / 100;
            let sellerIdx = Math.floor(Math.random() * allSubs.length);
            let buyerIdx;
            do { buyerIdx = Math.floor(Math.random() * allSubs.length); } while (buyerIdx === sellerIdx);
            const seller = allSubs[sellerIdx];
            const buyer = allSubs[buyerIdx];
            let amount;
            if (res.isExotic) {
                amount = Math.floor(Math.random() * 15) + 1;
            } else if (res.basePrice >= 200) amount = Math.floor(Math.random() * 10) + 1;
            else if (res.basePrice >= 50) amount = Math.floor(Math.random() * 30) + 5;
            else amount = Math.floor(Math.random() * 200) + 20;
            const total = Math.round(amount * gamePrice * 100) / 100;
            market.trades.push({ timestamp: randTime, resource: res.name, seller, buyer, amount, price: gamePrice, total, isExotic: res.isExotic });
        }
        market.trades.sort((a,b) => b.timestamp - a.timestamp);
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
    function generateEventsForMarket(marketKey) {
        const market = markets[marketKey];
        const resources = market.resources;
        const factors = resources.map(() => 1.0);
        const eventTexts = [];

        const possibleEvents = [
            { type: 'global', factor: 1.10, prob: 0.15, text: 'üîÜ –°–ø—Ä–æ—Å –Ω–∞ —ç–Ω–µ—Ä–≥–∏—é: —Ü–µ–Ω—ã +10%' },
            { type: 'global', factor: 0.92, prob: 0.1, text: 'üåßÔ∏è –ü–µ—Ä–µ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ: —Ü–µ–Ω—ã -8%' },
            { type: 'global', factor: 1.08, prob: 0.12, text: '‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–∫–∞—á–æ–∫: —Ü–µ–Ω—ã +8%' },
            { type: 'global', factor: 0.95, prob: 0.1, text: 'üíº –°–∫–ª–∞–¥—Å–∫–æ–π –∫—Ä–∏–∑–∏—Å: —Ü–µ–Ω—ã -5%' },
            { type: 'specific', factor: 0.85, prob: 0.15, text: '‚õèÔ∏è –ë–æ–≥–∞—Ç–æ–µ –º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ {res}: —Ü–µ–Ω–∞ -15%' },
            { type: 'specific', factor: 1.15, prob: 0.12, text: 'üî• –ê–≤–∞—Ä–∏—è –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ {res}: —Ü–µ–Ω–∞ +15%' },
            { type: 'specific', factor: 1.10, prob: 0.1, text: 'üè¥‚Äç‚ò†Ô∏è –ü–∏—Ä–∞—Ç—ã –∞—Ç–∞–∫—É—é—Ç {res}: —Ü–µ–Ω–∞ +10%' },
            { type: 'specific', factor: 0.90, prob: 0.08, text: '‚ú® –ù–∞—É—á–Ω—ã–π –ø—Ä–æ—Ä—ã–≤ –≤ {res}: —Ü–µ–Ω–∞ -10%' }
        ];

        for (let ev of possibleEvents) {
            if (Math.random() < ev.prob) {
                if (ev.type === 'global') {
                    for (let i = 0; i < factors.length; i++) factors[i] *= ev.factor;
                    eventTexts.push(ev.text);
                } else {
                    const nonExoticIndices = resources
                        .map((r, idx) => r.isExotic ? -1 : idx)
                        .filter(idx => idx !== -1);
                    if (nonExoticIndices.length === 0) continue;
                    const idx = nonExoticIndices[Math.floor(Math.random() * nonExoticIndices.length)];
                    factors[idx] *= ev.factor;
                    eventTexts.push(ev.text.replace('{res}', resources[idx].name));
                }
            }
        }
        return { events: eventTexts.slice(0, 3), factors };
    }

    // –ó–∞–ø—Ä–æ—Å –∫ CoinGecko
    async function fetchCryptoPrices() {
        const allIds = [];
        for (let key in markets) {
            markets[key].resources.forEach(r => {
                if (r.cryptoId) allIds.push(r.cryptoId);
            });
        }
        const uniqueIds = [...new Set(allIds)];
        const ids = uniqueIds.join(',');
        const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`;
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.json();
            const prices = {};
            uniqueIds.forEach(id => {
                prices[id] = data[id]?.usd ?? null;
            });
            apiError = false;
            document.getElementById('api-error').style.display = 'none';
            return prices;
        } catch (e) {
            console.warn('–û—à–∏–±–∫–∞ API', e);
            apiError = true;
            document.getElementById('api-error').style.display = 'block';
            const FALLBACK = {
                'bitcoin':65000,'ethereum':3500,'solana':145,'dogecoin':0.15,'chainlink':18,
                'matic-network':0.85,'litecoin':85,'ripple':0.62,'cardano':0.55,'binancecoin':580,
                'polkadot':7.5,'avalanche-2':35,'stellar':0.12,'cosmos':9.5,'uniswap':11,'polygon':0.85
            };
            const fallback = {};
            uniqueIds.forEach(id => {
                fallback[id] = prevCryptoPrices[id] || FALLBACK[id] || (50 + Math.random() * 200);
            });
            return fallback;
        }
    }

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä—ã–Ω–∫–∞
    async function refreshMarket(marketKey, cryptoPrices) {
        const market = markets[marketKey];
        const resources = market.resources;
        const { events: newEvents, factors: eventFactors } = generateEventsForMarket(marketKey);

        if (newEvents.length > 0) {
            const timestampStr = new Date().toLocaleTimeString('ru-RU', { hour12: false, hour: '2-digit', minute: '2-digit' });
            newEvents.forEach(evText => {
                market.events.unshift(`[${timestampStr}] ${evText}`);
            });
            if (market.events.length > 20) market.events = market.events.slice(0, 20);
        }

        for (let i = 0; i < resources.length; i++) {
            const r = resources[i];
            if (r.isExotic) {
                market.currentPrices[r.name] = 9999;
                if (!market.priceHistory[i]) market.priceHistory[i] = [];
                market.priceHistory[i].push(9999);
                if (market.priceHistory[i].length > 30) market.priceHistory[i].shift();
                continue;
            }

            const current = cryptoPrices[r.cryptoId] || prevCryptoPrices[r.cryptoId] || 1;
            const yesterday = prevCryptoPrices[r.cryptoId] || current;

            const ratio = yesterday > 0 ? current / yesterday : 1;
            const randomFactor = 1 + (Math.random() * 0.1 - 0.05);
            const eventFactor = eventFactors[i];

            let gamePrice = r.basePrice * ratio * randomFactor * eventFactor;
            gamePrice = Math.round(gamePrice * 100) / 100;

            market.currentPrices[r.name] = gamePrice;

            if (!market.priceHistory[i]) market.priceHistory[i] = [];
            market.priceHistory[i].push(gamePrice);
            if (market.priceHistory[i].length > 30) market.priceHistory[i].shift();
        }

        const newTradesCount = Math.floor(Math.random() * 4) + 1;
        for (let i = 0; i < newTradesCount; i++) {
            const useExotic = Math.random() < 0.15;
            let candidateIndices;
            if (useExotic) {
                candidateIndices = resources
                    .map((r, idx) => r.isExotic ? idx : -1)
                    .filter(idx => idx !== -1);
            } else {
                candidateIndices = resources
                    .map((r, idx) => !r.isExotic ? idx : -1)
                    .filter(idx => idx !== -1);
            }
            if (candidateIndices.length === 0) continue;
            const resIdx = candidateIndices[Math.floor(Math.random() * candidateIndices.length)];
            const trade = generateRandomTrade(marketKey, resIdx, Date.now());
            if (trade) market.trades.unshift(trade);
        }

        const now = Date.now();
        const thirtyDaysAgo = now - 30 * 24 * 60 * 60 * 1000;
        market.trades = market.trades.filter(t => t.timestamp >= thirtyDaysAgo);
        if (market.trades.length > 1500) market.trades = market.trades.slice(0, 1500);
        market.trades.sort((a,b) => b.timestamp - a.timestamp);
    }

    function generateRandomTrade(marketKey, resIdx, timestamp) {
        const market = markets[marketKey];
        const res = market.resources[resIdx];
        const gamePrice = market.currentPrices[res.name];
        if (!gamePrice) return null;
        if (allSubs.length < 2) return null;
        let sellerIdx = Math.floor(Math.random() * allSubs.length);
        let buyerIdx;
        do { buyerIdx = Math.floor(Math.random() * allSubs.length); } while (buyerIdx === sellerIdx);
        const seller = allSubs[sellerIdx];
        const buyer = allSubs[buyerIdx];
        let amount;
        if (res.isExotic) {
            amount = Math.floor(Math.random() * 20) + 1;
        } else if (res.basePrice >= 200) amount = Math.floor(Math.random() * 10) + 1;
        else if (res.basePrice >= 50) amount = Math.floor(Math.random() * 30) + 5;
        else amount = Math.floor(Math.random() * 200) + 20;
        const total = Math.round(amount * gamePrice * 100) / 100;
        return { timestamp, resource: res.name, seller, buyer, amount, price: gamePrice, total, isExotic: res.isExotic };
    }

    // ================== –û–¢–†–ò–°–û–í–ö–ê ==================
    function renderCurrentMarket() {
        const market = markets[currentMarket];
        document.getElementById('events-title').innerText = `üì° –°–æ–±—ã—Ç–∏—è ${market.name.toLowerCase()}`;
        document.getElementById('market-title').innerHTML = `üìà –ö–æ—Ç–∏—Ä–æ–≤–∫–∏ ${market.name.toLowerCase()}`;
        document.getElementById('trades-title').innerHTML = `üìú –°–¥–µ–ª–∫–∏ —Å ${market.name.toLowerCase()} –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü`;
        renderPrices(market);
        renderEvents(market);
        renderTrades(market);
    }

    function renderPrices(market) {
        const tbody = document.getElementById('price-table-body');
        let html = '';
        for (let i = 0; i < market.resources.length; i++) {
            const r = market.resources[i];
            const gamePrice = market.currentPrices[r.name] || r.basePrice;
            const history = market.priceHistory[i] || [r.basePrice];
            const spark = renderSparkline(history);
            const color = r.color || '#cccccc';
            html += `<tr>
                <td><span class="color-indicator" style="background-color: ${color};"></span><span class="editable-name" data-market="${currentMarket}" data-index="${i}">${r.name}</span></td>
                <td>‚Ç°${r.basePrice.toFixed(2)}</td>
                <td style="color:#3f6b4f; font-weight:600;">‚Ç°${gamePrice.toFixed(2)}</td>
                <td><div class="spark">${spark}</div></td>
                <td><button class="buy-btn" onclick="window._buyResource('${currentMarket}',${i})">ü™ô –ö—É–ø–∏—Ç—å</button>
                    <button class="sell-btn" onclick="window._sellResource('${currentMarket}',${i})">üí∞ –ü—Ä–æ–¥–∞—Ç—å</button></td>
            </tr>`;
        }
        tbody.innerHTML = html;
        attachNameEditListeners();
    }

    function renderSparkline(history) {
        if (!history.length) return '';
        const width = 120, height = 40;
        const min = Math.min(...history);
        const max = Math.max(...history);
        const range = max - min || 1;
        const points = history.map((val, idx) => {
            const x = (idx / (history.length - 1)) * width;
            const y = height - ((val - min) / range) * height;
            return `${x},${y}`;
        }).join(' ');
        return `<svg viewBox="0 0 ${width} ${height}" preserveAspectRatio="none">
            <polyline points="${points}" stroke="#9d6b4a" stroke-width="2" fill="none" />
        </svg>`;
    }

    function renderEvents(market) {
        const container = document.getElementById('eventsList');
        if (market.events.length === 0) {
            container.innerHTML = '<div class="event-item">–°–æ–±—ã—Ç–∏–π –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ</div>';
            return;
        }
        let html = '';
        market.events.forEach(ev => {
            let cls = '';
            if (ev.includes('–∞–≤–∞—Ä–∏—è') || ev.includes('–ø–∏—Ä–∞—Ç') || ev.includes('–∫—Ä–∏–∑–∏—Å')) cls = 'event-high';
            else if (ev.includes('–º–µ—Å—Ç–æ—Ä–æ–∂–¥–µ–Ω–∏–µ') || ev.includes('–ø—Ä–æ—Ä—ã–≤') || ev.includes('—Å–≤–µ—Ä—Ö–Ω–æ–≤–∞—è')) cls = 'event-low';
            html += `<div class="event-item ${cls}">${ev}</div>`;
        });
        container.innerHTML = html;
    }

    function renderTrades(market) {
        const tbody = document.getElementById('trade-table-body');
        if (!market.trades.length) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">–ù–µ—Ç —Å–¥–µ–ª–æ–∫</td></tr>';
            return;
        }
        const top50 = market.trades.slice(0, 50);
        let html = '';
        top50.forEach(t => {
            const date = new Date(t.timestamp).toLocaleString('ru-RU', {
                day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit', second:'2-digit'
            }).replace(',','');
            const amountDisplay = t.isExotic ? t.amount + ' –∫–≤–∞–Ω—Ç–æ–≤' : t.amount;
            html += `<tr>
                <td>${date}</td>
                <td>${t.resource}</td>
                <td>${t.seller}</td>
                <td>${t.buyer}</td>
                <td>${amountDisplay}</td>
                <td>‚Ç°${t.price.toFixed(2)}</td>
                <td>‚Ç°${t.total.toFixed(2)}</td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    function renderCorporations() {
        let html = '';
        corporations.forEach(corp => {
            html += `<div class="corp-group"><strong>${corp.name}</strong><ul>`;
            corp.subs.forEach(sub => { html += `<li>${sub}</li>`; });
            html += `</ul></div>`;
        });
        document.getElementById('corp-list').innerHTML = html;
    }

    // ================== –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ù–ê–ó–í–ê–ù–ò–ô ==================
    function attachNameEditListeners() {
        document.querySelectorAll('.editable-name').forEach(el => {
            el.removeEventListener('dblclick', startEdit);
            el.addEventListener('dblclick', startEdit);
        });
    }

    function startEdit(e) {
        const span = e.target;
        if (span.classList.contains('editing')) return;
        const oldName = span.innerText;
        const marketKey = span.dataset.market;
        const index = span.dataset.index;
        const input = document.createElement('input');
        input.type = 'text';
        input.value = oldName;
        input.classList.add('edit-input');
        span.innerHTML = '';
        span.appendChild(input);
        span.classList.add('editing');
        input.focus();
        input.addEventListener('blur', () => finishEdit(span, marketKey, index, input.value));
        input.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter') {
                ev.preventDefault();
                input.blur();
            }
        });
    }

    function finishEdit(span, marketKey, index, newName) {
        span.classList.remove('editing');
        if (!newName.trim()) {
            span.innerText = span.dataset.oldName || '?';
            return;
        }
        const market = markets[marketKey];
        const resource = market.resources[index];
        const oldName = resource.name;
        if (oldName === newName) {
            span.innerText = oldName;
            return;
        }
        resource.name = newName;
        market.currentPrices[newName] = market.currentPrices[oldName];
        delete market.currentPrices[oldName];
        market.trades.forEach(t => {
            if (t.resource === oldName) t.resource = newName;
        });
        span.innerText = newName;
        saveToLocalStorage();
        renderPrices(market);
    }

    // ================== (—ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç —É–¥–∞–ª–µ–Ω—ã ‚Äî –Ω–µ –Ω—É–∂–Ω—ã –∏–≥—Ä–æ–∫—É) ==================
    function exportConfig() {
        const config = {};
        for (let key in markets) {
            config[key] = {
                name: markets[key].name,
                resources: markets[key].resources.map(r => ({
                    name: r.name,
                    basePrice: r.basePrice,
                    isExotic: r.isExotic,
                    cryptoId: r.cryptoId
                }))
            };
        }
        const dataStr = JSON.stringify(config, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'markets_config.json';
        a.click();
        URL.revokeObjectURL(url);
    }

    function importConfig(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const config = JSON.parse(e.target.result);
                for (let key in config) {
                    if (!markets[key]) continue;
                    if (!config[key].resources || !Array.isArray(config[key].resources)) throw new Error('–ù–µ—Ç resources');
                    markets[key].resources = config[key].resources.map(r => ({
                        ...r,
                        isExotic: r.isExotic || false
                    }));
                }
                applyColorsAndReset();
                initPricesAndTrades();
                renderCurrentMarket();
                saveToLocalStorage();
            } catch (err) {
                alert('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ JSON: ' + err.message);
            }
            document.getElementById('import-file-input').value = '';
        };
        reader.readAsText(file);
    }

    // ================== –û–ë–ù–û–í–õ–ï–ù–ò–ï ==================
    async function updateCurrentMarket(manual = false) {
        const cryptoPrices = await fetchCryptoPrices();
        prevCryptoPrices = { ...prevCryptoPrices, ...cryptoPrices };
        await refreshMarket(currentMarket, cryptoPrices);
        renderCurrentMarket();
        document.getElementById('last-update-time').innerText = new Date().toLocaleTimeString('ru-RU', { hour12: false });
        if (manual) {
            nextUpdateTime = Date.now() + 10 * 60 * 1000;
        }
    }

    function startCountdown() {
        setInterval(() => {
            const now = Date.now();
            const diff = nextUpdateTime - now;
            if (diff <= 0) {
                nextUpdateTime = now + 10 * 60 * 1000;
                updateCurrentMarket(false);
            }
            const totalSec = Math.max(0, Math.floor(diff / 1000));
            const min = Math.floor(totalSec / 60);
            const sec = totalSec % 60;
            document.getElementById('next-update').innerText = `${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
        }, 500);
    }

    // ================== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ==================
    function setupTabs() {
        const tabs = document.querySelectorAll('.tab-button');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const marketKey = tab.dataset.market;
                if (!marketKey) return;
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentMarket = marketKey;
                renderCurrentMarket();
                document.getElementById('last-update-time').innerText = new Date().toLocaleTimeString('ru-RU', { hour12: false });
            });
        });
    }

    // ================== –ó–ê–ü–£–°–ö ==================
    document.addEventListener('DOMContentLoaded', async () => {
        const loaded = loadFromLocalStorage();
        if (!loaded) {
            initDefaultResources();
        }
        ensureAllSectors();
        applyColorsAndReset();
        initPricesAndTrades();
        renderCorporations();
        setupTabs();
        await updateCurrentMarket(false);
        startCountdown();

        if (!loaded) {
            saveToLocalStorage();
        }

        autosaveTimer = setInterval(saveToLocalStorage, 300000);

        document.getElementById('manual-update').addEventListener('click', () => {
            updateCurrentMarket(true);
        });

        // Hub communication
        window._gs = null;
        window.addEventListener('message', e => { if(e.data&&e.data.type==='game_state') window._gs=e.data.state; });
        if(window.parent!==window) window.parent.postMessage({type:'get_state'},'*');
        window.hubMsg = function(msg){ if(window.parent!==window) window.parent.postMessage(msg,'*'); };

        function showTradeMsg(text) {
            const d = document.createElement('div');
            d.className = 'trade-msg';
            d.textContent = text;
            document.body.appendChild(d);
            setTimeout(() => d.remove(), 3000);
        }

        window._buyResource = function(marketKey, idx) {
            const m = markets[marketKey];
            if (!m) return;
            const r = m.resources[idx];
            if (!r) return;
            const price = m.currentPrices[r.name] || r.basePrice;
            if (window.hubMsg) {
                window.hubMsg({ type: 'credits_change', amount: -Math.round(price) });
                window.hubMsg({ type: 'cargo_add', name: r.name, qty: 1, price: Math.round(price) });
                window.hubMsg({ type: 'stat_increment', stat: 'trades' });
                window.hubMsg({ type: 'status_msg', text: '–ö—É–ø–ª–µ–Ω–æ: ' + r.name + ' –∑–∞ ‚Ç°' + price.toFixed(0) });
            }
            showTradeMsg('ü™ô –ö—É–ø–ª–µ–Ω–æ: ' + r.name + ' ‚Äî ‚Ç°' + price.toFixed(0));
        };

        window._sellResource = function(marketKey, idx) {
            const m = markets[marketKey];
            if (!m) return;
            const r = m.resources[idx];
            if (!r) return;
            const price = m.currentPrices[r.name] || r.basePrice;
            const sellPrice = Math.round(price * 0.85);
            if (window.hubMsg) {
                window.hubMsg({ type: 'credits_change', amount: sellPrice });
                window.hubMsg({ type: 'stat_increment', stat: 'trades' });
                window.hubMsg({ type: 'status_msg', text: '–ü—Ä–æ–¥–∞–Ω–æ: ' + r.name + ' –∑–∞ ‚Ç°' + sellPrice });
            }
            showTradeMsg('üí∞ –ü—Ä–æ–¥–∞–Ω–æ: ' + r.name + ' ‚Äî ‚Ç°' + sellPrice);
        };
    });
})();
</script>
</body>
</html>